{% extends "base.html" %}

{% block title %}API Keys - Dashboard{% endblock %}

{% block content %}
<div class="min-h-screen">
  <main class="max-w-[1400px] mx-auto px-4 sm:px-6 lg:px-8 py-6 lg:py-10 space-y-10 pb-24">
    
    <!-- Top Bar -->
    <div class="grid grid-cols-1 md:grid-cols-2 items-start gap-4">
      <div>
        <h1 class="text-3xl font-bold text-base-content">API Keys</h1>
        <p class="text-base-content/70 mt-1">Manage your API keys for integrating with external services</p>
      </div>
      <div class="md:justify-self-end flex flex-wrap gap-2">
        <button type="submit" form="api-keys-form" class="btn btn-primary h-9 min-h-9 focus-visible:outline focus-visible:outline-2 focus-visible:outline-primary">
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path>
          </svg>
          Save Changes
        </button>
        <button type="button" onclick="resetForm()" class="btn btn-outline btn-ghost h-9 min-h-9 focus-visible:outline focus-visible:outline-2 focus-visible:outline-primary">
          <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
          </svg>
          Reset
        </button>
      </div>
    </div>

    <!-- API Keys Form -->
    <div class="card bg-base-200/50 border border-base-content/10">
      <div class="card-body p-6 lg:p-8">
        <form id="api-keys-form" method="POST" action="{% url 'dashboard:save_api_keys' %}" class="space-y-8">
          {% csrf_token %}
          
          <!-- Azure OpenAI Realtime Model Section -->
          <div class="space-y-6">
            <div class="flex items-center gap-3 pb-3 border-b border-base-content/10">
              <div class="w-8 h-8 rounded-lg bg-blue-500/10 flex items-center justify-center">
                <svg class="w-4 h-4 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
              </div>
              <div>
                <h3 class="text-lg font-semibold text-base-content">Azure OpenAI Realtime Model</h3>
                <p class="text-sm text-base-content/60">Configuration for Azure OpenAI real-time processing</p>
              </div>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
              <!-- Azure OpenAI Realtime Endpoint -->
              <div class="space-y-2">
                <label for="azure_openai_realtime_endpoint" class="block text-sm font-medium text-base-content">
                  Realtime Model Endpoint
                  <span class="text-error">*</span>
                </label>
                <div class="relative">
                  <input 
                    type="url" 
                    id="azure_openai_realtime_endpoint" 
                    name="azure_openai_realtime_endpoint" 
                    value="{{ api_keys.azure_openai_realtime_endpoint|default:'' }}"
                    placeholder="https://your-resource.openai.azure.com/"
                    class="input input-bordered w-full bg-base-100 border-base-content/20 pr-10 focus:border-primary focus:ring-1 focus:ring-primary"
                    required
                  >
                  <div class="absolute inset-y-0 right-0 pr-3 flex items-center">
                    <svg class="w-4 h-4 text-base-content/40" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path>
                    </svg>
                  </div>
                </div>
                <p class="text-xs text-base-content/50">Azure OpenAI service endpoint URL</p>
              </div>

              <!-- Azure OpenAI Realtime Key -->
              <div class="space-y-2">
                <label for="azure_openai_realtime_key" class="block text-sm font-medium text-base-content">
                  Realtime Model Key
                  <span class="text-error">*</span>
                </label>
                <div class="relative">
                  <input 
                    type="password" 
                    id="azure_openai_realtime_key" 
                    name="azure_openai_realtime_key" 
                    value="{{ api_keys.azure_openai_realtime_key|default:'' }}"
                    placeholder="••••••••••••••••••••••••••••••••"
                    class="input input-bordered w-full bg-base-100 border-base-content/20 pr-10 focus:border-primary focus:ring-1 focus:ring-primary"
                    required
                  >
                  <button type="button" onclick="togglePasswordVisibility('azure_openai_realtime_key')" class="absolute inset-y-0 right-0 pr-3 flex items-center">
                    <svg class="w-4 h-4 text-base-content/40 hover:text-base-content transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                    </svg>
                  </button>
                </div>
                <p class="text-xs text-base-content/50">API key for Azure OpenAI realtime model</p>
              </div>
            </div>
          </div>

          <!-- Azure GPT5 Mini Section -->
          <div class="space-y-6">
            <div class="flex items-center gap-3 pb-3 border-b border-base-content/10">
              <div class="w-8 h-8 rounded-lg bg-purple-500/10 flex items-center justify-center">
                <svg class="w-4 h-4 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                </svg>
              </div>
              <div>
                <h3 class="text-lg font-semibold text-base-content">Azure GPT5 Mini</h3>
                <p class="text-sm text-base-content/60">Configuration for Azure GPT-5 Mini model</p>
              </div>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
              <!-- Azure GPT5 Mini Endpoint -->
              <div class="space-y-2">
                <label for="azure_gpt5_mini_endpoint" class="block text-sm font-medium text-base-content">
                  GPT5 Mini Endpoint
                  <span class="text-error">*</span>
                </label>
                <div class="relative">
                  <input 
                    type="url" 
                    id="azure_gpt5_mini_endpoint" 
                    name="azure_gpt5_mini_endpoint" 
                    value="{{ api_keys.azure_gpt5_mini_endpoint|default:'' }}"
                    placeholder="https://your-resource.openai.azure.com/"
                    class="input input-bordered w-full bg-base-100 border-base-content/20 pr-10 focus:border-primary focus:ring-1 focus:ring-primary"
                    required
                  >
                  <div class="absolute inset-y-0 right-0 pr-3 flex items-center">
                    <svg class="w-4 h-4 text-base-content/40" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path>
                    </svg>
                  </div>
                </div>
                <p class="text-xs text-base-content/50">Azure OpenAI GPT-5 Mini endpoint URL</p>
              </div>

              <!-- Azure GPT5 Mini Key -->
              <div class="space-y-2">
                <label for="azure_gpt5_mini_key" class="block text-sm font-medium text-base-content">
                  GPT5 Mini Key
                  <span class="text-error">*</span>
                </label>
                <div class="relative">
                  <input 
                    type="password" 
                    id="azure_gpt5_mini_key" 
                    name="azure_gpt5_mini_key" 
                    value="{{ api_keys.azure_gpt5_mini_key|default:'' }}"
                    placeholder="••••••••••••••••••••••••••••••••"
                    class="input input-bordered w-full bg-base-100 border-base-content/20 pr-10 focus:border-primary focus:ring-1 focus:ring-primary"
                    required
                  >
                  <button type="button" onclick="togglePasswordVisibility('azure_gpt5_mini_key')" class="absolute inset-y-0 right-0 pr-3 flex items-center">
                    <svg class="w-4 h-4 text-base-content/40 hover:text-base-content transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                    </svg>
                  </button>
                </div>
                <p class="text-xs text-base-content/50">API key for Azure GPT-5 Mini model</p>
              </div>
            </div>
          </div>

          <!-- ElevenLabs Section -->
          <div class="space-y-6">
            <div class="flex items-center gap-3 pb-3 border-b border-base-content/10">
              <div class="w-8 h-8 rounded-lg bg-green-500/10 flex items-center justify-center">
                <svg class="w-4 h-4 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M9 9l3 3-3 3m4 0h4"></path>
                </svg>
              </div>
              <div>
                <h3 class="text-lg font-semibold text-base-content">ElevenLabs</h3>
                <p class="text-sm text-base-content/60">Configuration for ElevenLabs voice synthesis</p>
              </div>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
              <!-- ElevenLabs Key -->
              <div class="space-y-2">
                <label for="elevenlabs_key" class="block text-sm font-medium text-base-content">
                  ElevenLabs API Key
                  <span class="text-error">*</span>
                </label>
                <div class="relative">
                  <input 
                    type="password" 
                    id="elevenlabs_key" 
                    name="elevenlabs_key" 
                    value="{{ api_keys.elevenlabs_key|default:'' }}"
                    placeholder="••••••••••••••••••••••••••••••••"
                    class="input input-bordered w-full bg-base-100 border-base-content/20 pr-10 focus:border-primary focus:ring-1 focus:ring-primary"
                    required
                  >
                  <button type="button" onclick="togglePasswordVisibility('elevenlabs_key')" class="absolute inset-y-0 right-0 pr-3 flex items-center">
                    <svg class="w-4 h-4 text-base-content/40 hover:text-base-content transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                    </svg>
                  </button>
                </div>
                <p class="text-xs text-base-content/50">API key for ElevenLabs voice synthesis</p>
              </div>

              <!-- Placeholder for future expansion -->
              <div class="space-y-2">
                <label class="block text-sm font-medium text-base-content/40">
                  Additional Settings
                </label>
                <div class="flex items-center justify-center h-12 border-2 border-dashed border-base-content/10 rounded-lg">
                  <span class="text-sm text-base-content/40">Reserved for future configuration</span>
                </div>
              </div>
            </div>
          </div>

        </form>
      </div>
    </div>

    <!-- Status Cards -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
      <!-- Connection Status Cards -->
      <div class="card bg-base-200/30 border border-base-content/10">
        <div class="card-body p-4">
          <div class="flex items-center gap-3">
            <div class="w-8 h-8 rounded-full bg-success/10 flex items-center justify-center">
              <svg class="w-4 h-4 text-success" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
            </div>
            <div>
              <h4 class="font-medium text-base-content">Azure OpenAI</h4>
              <p class="text-xs text-base-content/60">Connected</p>
            </div>
          </div>
        </div>
      </div>

      <div class="card bg-base-200/30 border border-base-content/10">
        <div class="card-body p-4">
          <div class="flex items-center gap-3">
            <div class="w-8 h-8 rounded-full bg-warning/10 flex items-center justify-center">
              <svg class="w-4 h-4 text-warning" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
            </div>
            <div>
              <h4 class="font-medium text-base-content">GPT5 Mini</h4>
              <p class="text-xs text-base-content/60">Testing</p>
            </div>
          </div>
        </div>
      </div>

      <div class="card bg-base-200/30 border border-base-content/10">
        <div class="card-body p-4">
          <div class="flex items-center gap-3">
            <div class="w-8 h-8 rounded-full bg-success/10 flex items-center justify-center">
              <svg class="w-4 h-4 text-success" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
              </svg>
            </div>
            <div>
              <h4 class="font-medium text-base-content">ElevenLabs</h4>
              <p class="text-xs text-base-content/60">Connected</p>
            </div>
          </div>
        </div>
      </div>
    </div>

  </main>
</div>

<!-- API Keys Page Scripts -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Password visibility toggle
  window.togglePasswordVisibility = function(fieldId) {
    const field = document.getElementById(fieldId);
    const isPassword = field.type === 'password';
    field.type = isPassword ? 'text' : 'password';
    
    // Update icon
    const button = field.nextElementSibling;
    const icon = button.querySelector('svg');
    
    if (isPassword) {
      // Show eye-off icon
      icon.innerHTML = `
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.878 9.878L3 3m6.878 6.878L21 21"></path>
      `;
    } else {
      // Show eye icon
      icon.innerHTML = `
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
      `;
    }
  };

  // Reset form function
  window.resetForm = function() {
    const form = document.getElementById('api-keys-form');
    const originalValues = {};
    
    // Store original values
    const inputs = form.querySelectorAll('input[type="url"], input[type="password"]');
    inputs.forEach(input => {
      originalValues[input.name] = input.getAttribute('value') || '';
    });
    
    // Reset form
    form.reset();
    
    // Restore original values
    inputs.forEach(input => {
      input.value = originalValues[input.name];
    });
    
    showInfoToast('Form reset to saved values');
  };

  // Form submission handling
  const form = document.getElementById('api-keys-form');
  form.addEventListener('submit', function(e) {
    e.preventDefault();
    
    // Show loading state
    const submitBtn = form.querySelector('button[type="submit"]');
    const originalText = submitBtn.innerHTML;
    submitBtn.innerHTML = `
      <span class="loading loading-spinner loading-sm mr-2"></span>
      Saving...
    `;
    submitBtn.disabled = true;

    // Simulate API call (replace with actual implementation)
    setTimeout(() => {
      submitBtn.innerHTML = originalText;
      submitBtn.disabled = false;
      showSuccessToast('API keys saved successfully!');
    }, 1500);
  });

  // Input validation
  const urlInputs = form.querySelectorAll('input[type="url"]');
  urlInputs.forEach(input => {
    input.addEventListener('blur', function() {
      if (this.value && !this.value.startsWith('https://')) {
        this.setCustomValidity('URL must start with https://');
        this.reportValidity();
      } else {
        this.setCustomValidity('');
      }
    });
  });
});
</script>
{% endblock %}
